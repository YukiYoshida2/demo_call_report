---
name: compute-tables
description: Pythonスクリプトで全分析テーブルを確定計算する。LLMによる計算を排除し、再現性のある正確な数値を保証する。
---

# テーブル計算スキル

Pythonスクリプトで全分析テーブル（STEP1: 1-1〜1-4、STEP2: 2-1〜2-5-d）を確定計算し、`data/computed/` にMarkdownファイルとして出力する。

## 実行手順

1. `data/` 内の最新日付CSVを特定する
2. 以下のコマンドを実行:
   ```
   python3 scripts/compute_tables.py --date {YYYY-MM-DD}
   ```
3. 終了コードを確認（0=成功, 1=エラー）
4. `data/computed/_validation.md` を読み、警告・エラーがないか確認
5. エラーがあった場合はユーザーに報告して停止
6. 正常完了した場合は、当月リード数と出力ファイル数をユーザーに報告

## 前提

- `/fetch-data` で当日分のCSVが `data/` に保存済みであること
- Python 3.9+ が利用可能であること
- 標準ライブラリのみ使用（外部パッケージ不要）

## 出力

`data/computed/` に以下の13ファイルが生成される:

| ファイル | 内容 |
|---------|------|
| `_validation.md` | データ検証結果 |
| `step1_着電着予.md` | 1-1: 着電数の着地予測 vs 目標 |
| `step1_SAL着予.md` | 1-2: SAL数の着地予測 vs 目標 |
| `step1_商談実施着予.md` | 1-3: 商談実施数の着地予測 vs 目標 |
| `step1_課題チャネル.md` | 1-4: 課題チャネル一覧 |
| `step2_ファネル転換率.md` | 2-1: チャネル別ファネル転換率 + 絶対数 |
| `step2_CVコンテンツ.md` | 2-2: チャネル別CVコンテンツTop10 |
| `step2_SALスピード.md` | 2-3: SAL日数分布 |
| `step2_時系列.md` | 2-4: 週別・営業時間・平休トレンド |
| `step2_担当者サマリ.md` | 2-5-a: 担当者別サマリ |
| `step2_担当者チャネル.md` | 2-5-b: 担当者×チャネル |
| `step2_インパクト試算.md` | 2-5-c: 担当者インパクト試算 |
| `step2_週次急落.md` | 2-5-d: 週次急落検知 |

## 計算ロジックの参照

全計算ロジックは `scripts/compute_tables.py` に実装されている。
主要な計算ルールは CLAUDE.md のグローバルフィルタ条件・前月比表記ルールに準拠。
